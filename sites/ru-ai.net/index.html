<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Verification System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .challenge {
            background: #f5f5f5;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .challenge-title {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .challenge-description {
            color: #555;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 15px;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            font-family: 'Courier New', monospace;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }

        .result.robot {
            background: #ff6b6b;
            color: white;
        }

        .result.human {
            background: #51cf66;
            color: white;
        }

        .result h2 {
            font-size: 28px;
            margin-bottom: 15px;
        }

        .result p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-box {
            aspect-ratio: 1;
            border-radius: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .color-box:hover {
            transform: scale(1.05);
        }

        .color-box.selected {
            border-color: #333;
            transform: scale(0.95);
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider-value {
            text-align: center;
            font-size: 18px;
            color: #667eea;
            margin-bottom: 10px;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 0;
        }

        .word-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .word-option {
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .word-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .word-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>🤖 HUMAN VERIFICATION PROTOCOL</h1>
    <p class="subtitle">Please complete the following challenges to prove you are human</p>

    <div id="error" class="error hidden"></div>
    <div id="challenges"></div>

    <button id="submitBtn" class="hidden">Submit Verification</button>

    <div id="loading" class="hidden">
        <div class="spinner"></div>
        <p style="text-align: center; color: #666;">Analyzing responses with AI...</p>
    </div>

    <div id="result" class="hidden"></div>
</div>
<script src="config.js"></script>

<script type="module">
    import { CognitoIdentityClient } from 'https://esm.sh/@aws-sdk/client-cognito-identity@3.450.0';
    import { fromCognitoIdentityPool } from 'https://esm.sh/@aws-sdk/credential-providers@3.450.0';
    import { BedrockRuntimeClient, InvokeModelCommand } from 'https://esm.sh/@aws-sdk/client-bedrock-runtime@3.450.0';


    const allChallenges = [
        {
            id: 'existential',
            title: 'Existential Query',
            description: 'In exactly 7 words, describe the color blue to someone who has never seen.',
            type: 'text',
            validate: (answer) => answer.trim().split(/\s+/).length === 7
        },
        {
            id: 'color-tuesday',
            title: 'Chromatic Intuition Test',
            description: 'Select the color that best represents the feeling of "Tuesday afternoon".',
            type: 'color',
            colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'],
            validate: () => true
        },
        {
            id: 'math-seconds',
            title: 'Temporal Mathematics',
            description: 'How many seconds have you been alive? (Approximate is fine)',
            type: 'number',
            validate: (answer) => answer > 0
        },
        {
            id: 'dream',
            title: 'Subconscious Analysis',
            description: 'Describe your most recent dream in haiku format (5-7-5 syllables).',
            type: 'textarea',
            validate: (answer) => answer.length > 10
        },
        {
            id: 'sound-taste',
            title: 'Synesthetic Perception',
            description: 'What does the number 7 taste like? Be specific.',
            type: 'text',
            validate: (answer) => answer.length > 5
        },
        {
            id: 'philosophical',
            title: 'Philosophical Paradox',
            description: 'If a tree falls in a forest and no one is around, what color is it?',
            type: 'text',
            validate: (answer) => answer.length > 0
        },
        {
            id: 'emotion-number',
            title: 'Emotional Quantification',
            description: 'On a scale of 1-100, how purple is the emotion "nostalgia"?',
            type: 'slider',
            min: 1,
            max: 100,
            validate: () => true
        },
        {
            id: 'memory-texture',
            title: 'Sensory Memory Test',
            description: 'What texture is your earliest childhood memory?',
            type: 'select',
            options: ['Smooth', 'Rough', 'Fuzzy', 'Sharp', 'Liquid', 'Granular', 'Ethereal', 'Crystalline'],
            validate: () => true
        },
        {
            id: 'word-association',
            title: 'Abstract Word Association',
            description: 'Which word best describes the smell of mathematics?',
            type: 'word-choice',
            options: ['Crisp', 'Musty', 'Metallic', 'Floral', 'Burnt', 'Oceanic'],
            validate: () => true
        },
        {
            id: 'time-perception',
            title: 'Temporal Perception Analysis',
            description: 'How long is a moment? (Provide your answer in milliseconds)',
            type: 'number',
            validate: (answer) => answer > 0
        }
    ];

    let selectedChallenges = [];
    let userAnswers = {};

    function init() {
        const numChallenges = Math.floor(Math.random() * 3) + 1;
        const shuffled = [...allChallenges].sort(() => Math.random() - 0.5);
        selectedChallenges = shuffled.slice(0, numChallenges);

        renderChallenges();
        document.getElementById('submitBtn').classList.remove('hidden');
    }

    function renderChallenges() {
        const container = document.getElementById('challenges');
        container.innerHTML = '';

        selectedChallenges.forEach((challenge, index) => {
            const div = document.createElement('div');
            div.className = 'challenge';

            let inputHTML = '';
            if (challenge.type === 'text') {
                inputHTML = `<input type="text" id="answer-${challenge.id}" placeholder="Type your answer here...">`;
            } else if (challenge.type === 'number') {
                inputHTML = `<input type="number" id="answer-${challenge.id}" placeholder="Enter a number...">`;
            } else if (challenge.type === 'textarea') {
                inputHTML = `<textarea id="answer-${challenge.id}" rows="4" placeholder="Type your answer here..."></textarea>`;
            } else if (challenge.type === 'color') {
                inputHTML = '<div class="color-grid" id="color-grid-' + challenge.id + '">';
                challenge.colors.forEach((color) => {
                    inputHTML += `<div class="color-box" style="background-color: ${color}" data-color="${color}" data-challenge="${challenge.id}" onclick="selectColor('${color}', '${challenge.id}')"></div>`;
                });
                inputHTML += '</div>';
            } else if (challenge.type === 'select') {
                inputHTML = `<select id="answer-${challenge.id}">
                        <option value="">-- Select an option --</option>`;
                challenge.options.forEach(option => {
                    inputHTML += `<option value="${option}">${option}</option>`;
                });
                inputHTML += `</select>`;
            } else if (challenge.type === 'slider') {
                const mid = Math.floor((challenge.min + challenge.max) / 2);
                inputHTML = `
                        <div class="slider-container">
                            <div class="slider-value" id="slider-value-${challenge.id}">${mid}</div>
                            <input type="range" id="answer-${challenge.id}" min="${challenge.min}" max="${challenge.max}" value="${mid}"
                                oninput="document.getElementById('slider-value-${challenge.id}').textContent = this.value">
                        </div>`;
            } else if (challenge.type === 'word-choice') {
                inputHTML = '<div class="word-options" id="word-choice-' + challenge.id + '">';
                challenge.options.forEach(option => {
                    inputHTML += `<div class="word-option" data-value="${option}" data-challenge="${challenge.id}"
                            onclick="selectWord('${option}', '${challenge.id}')">${option}</div>`;
                });
                inputHTML += '</div>';
            }

            div.innerHTML = `
                    <div class="challenge-title">Challenge ${index + 1}: ${challenge.title}</div>
                    <div class="challenge-description">${challenge.description}</div>
                    ${inputHTML}
                `;

            container.appendChild(div);
        });
    }

    window.selectColor = function(color, challengeId) {
        document.querySelectorAll(`[data-challenge="${challengeId}"]`).forEach(box => {
            box.classList.remove('selected');
        });
        event.target.classList.add('selected');
        userAnswers[challengeId] = color;
    };

    window.selectWord = function(word, challengeId) {
        document.querySelectorAll(`[data-challenge="${challengeId}"]`).forEach(option => {
            option.classList.remove('selected');
        });
        event.target.classList.add('selected');
        userAnswers[challengeId] = word;
    };

    async function getBedrockCredentials() {
        const credentials = fromCognitoIdentityPool({
            clientConfig: { region: CONFIG.region },
            identityPoolId: CONFIG.identityPoolId
        });
        return credentials;
    }

    function buildPrompt(challenges, answers) {
        let prompt = "You are analyzing responses to esoteric questions to determine if they were answered by a human or a bot. ";
        prompt += "Respond with ONLY 'YES' if you think this is a human, or 'NO' if you think this is a bot. ";
        prompt += "Do not provide any explanation, just YES or NO.\n\n";
        prompt += "Questions and Answers:\n\n";

        challenges.forEach((challenge, index) => {
            const answer = answers[challenge.id] || 'No answer provided';
            prompt += `${index + 1}. ${challenge.description}\n`;
            prompt += `Answer: ${answer}\n\n`;
        });

        return prompt;
    }

    async function callBedrock(prompt) {
        try {
            const credentials = await getBedrockCredentials();

            const client = new BedrockRuntimeClient({
                region: CONFIG.region,
                credentials: credentials
            });

            const payload = {
                anthropic_version: "bedrock-2023-05-31",
                max_tokens: 10,
                messages: [
                    {
                        role: "user",
                        content: prompt
                    }
                ]
            };

            const command = new InvokeModelCommand({
                modelId: CONFIG.bedrockModelId,
                contentType: "application/json",
                accept: "application/json",
                body: JSON.stringify(payload)
            });

            const response = await client.send(command);
            const responseBody = JSON.parse(new TextDecoder().decode(response.body));

            return responseBody.content[0].text.trim().toUpperCase();
        } catch (error) {
            console.error('Bedrock error:', error);
            throw error;
        }
    }

    document.getElementById('submitBtn').addEventListener('click', async () => {
        // Collect answers
        selectedChallenges.forEach(challenge => {
            if (challenge.type !== 'color' && challenge.type !== 'word-choice') {
                const input = document.getElementById(`answer-${challenge.id}`);
                if (input) {
                    userAnswers[challenge.id] = input.value;
                }
            }
        });

        // Show loading
        document.getElementById('submitBtn').classList.add('hidden');
        document.getElementById('challenges').classList.add('hidden');
        document.getElementById('error').classList.add('hidden');
        document.getElementById('loading').classList.remove('hidden');

        try {
            // Build prompt and call Bedrock
            const prompt = buildPrompt(selectedChallenges, userAnswers);
            const bedrockResponse = await callBedrock(prompt);

            // Determine if human or robot based on response
            const isHuman = bedrockResponse.includes('YES');

            setTimeout(() => showResult(isHuman), 1000);
        } catch (error) {
            document.getElementById('loading').classList.add('hidden');
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = 'Error: Unable to verify. Please try again. ' + error.message;
            errorDiv.classList.remove('hidden');
            document.getElementById('submitBtn').classList.remove('hidden');
            document.getElementById('challenges').classList.remove('hidden');
        }
    });

    function showResult(isHuman) {
        document.getElementById('loading').classList.add('hidden');
        const resultDiv = document.getElementById('result');

        if (isHuman) {
            const humanResponses = [
                "Congratulations! Our AI has determined you are genuinely human.",
                "Well done! Your responses exhibit authentic human characteristics.",
                "Success! The quantum algorithms confirm your humanity.",
                "Impressive! You've passed the Turing test with flying colors.",
                "Verified! Your existential dread levels are perfectly human.",
                "Confirmed! Only a human could answer with such beautiful chaos.",
                "Accepted! Your responses show the delightful irrationality of humanity."
            ];

            const response = humanResponses[Math.floor(Math.random() * humanResponses.length)];

            resultDiv.className = 'result human';
            resultDiv.innerHTML = `
                    <h2>✅ HUMAN VERIFIED</h2>
                    <p style="font-size: 20px; margin: 20px 0;"><strong>Status: HUMAN DETECTED</strong></p>
                    <p>${response}</p>
                    <p style="margin-top: 20px; font-style: italic;">Welcome, fellow carbon-based life form!</p>
                `;
        } else {
            const robotReasons = [
                "Response time was suspiciously consistent (±0.003ms)",
                "Cursor movement patterns displayed geometric precision",
                "Breathing rate remained at exactly 60 cycles per minute",
                "Existential dread levels below human threshold",
                "Failed to demonstrate irrational decision-making",
                "Perfect spelling indicates non-human origin",
                "Temporal consciousness misalignment detected",
                "Insufficient quantum uncertainty in responses",
                "Dreams contained too much logical coherence",
                "Color perception lacks emotional inconsistency"
            ];

            const randomReasons = robotReasons.sort(() => Math.random() - 0.5).slice(0, 3);

            resultDiv.className = 'result robot';
            resultDiv.innerHTML = `
                    <h2>⚠️ VERIFICATION FAILED</h2>
                    <p style="font-size: 20px; margin: 20px 0;"><strong>Status: ROBOT DETECTED</strong></p>
                    <p>Our AI has determined you are not human.</p>
                    <p style="margin-top: 20px;"><strong>Evidence:</strong></p>
                    <p>• ${randomReasons[0]}</p>
                    <p>• ${randomReasons[1]}</p>
                    <p>• ${randomReasons[2]}</p>
                    <p style="margin-top: 20px; font-style: italic;">Access denied. Please return to your charging station.</p>
                `;
        }

        resultDiv.classList.remove('hidden');
    }

    init();
</script>
</body>
</html>